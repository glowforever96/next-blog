---
title: "Github Actionsë¡œ Next.js í”„ë¡œì íŠ¸ CI/CD ìë™í™”, ë°°í¬ê¹Œì§€ (Feat. AWS EC2, Docker)"
date: "2025-03-24"
description: "CI/CD íŒŒì´í”„ë¼ì¸ì„ êµ¬ì¶•í•´ë³´ì"
author: "í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì ê¶Œìˆœìš©"
parentCategory: "DevOps"
tags: ["Nginx", "React", "AWS EC2", "Docker", "Github Actions", "Next.js"]
thumbnail: "/images/thumbnails/cicd.webp"
---

> ë¦¬ì•¡íŠ¸ ë”¥ë‹¤ì´ë¸Œ ì±…ì„ ì½ë˜ ì¤‘ Github Actions ì£¼ì œë¥¼ ë‹¤ë£¨ëŠ” ë‚´ìš©ì„ ì½ë‹¤ê°€ í•œë²ˆ CI/CD ìë™í™” ê²½í—˜, ì¸í”„ë¼ ìš´ì˜ì— ëŒ€í•œ ì´í•´ë„ ë˜í•œ ì¡°ê¸ˆì´ë¼ë„ ë†’ì´ê³  ì‹¶ì—ˆìŠµë‹ˆë‹¤. ìƒê°ë³´ë‹¤ í—˜ë‚œí•œ ê³¼ì •ì´ì—ˆê³  ë‚˜ì¤‘ì— í˜¹ì—¬ë‚˜ ì“¸ì¼ì´ ìˆë‹¤ë©´ ìœ ìš©í• ë“¯ ì‹¶ì–´ ê¸°ë¡ í•´ë‘¡ë‹ˆë‹¤.
> (ì‘ì—…ì€ ëª¨ë‘ macOS ê¸°ì¤€ì—ì„œ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤)

> ë°ë¸Œì˜µìŠ¤ì˜ ë°ìë„ ëª¨ë¥´ê¸°ì— ì˜ëª»ëœ ë¶€ë¶„ì´ ìˆë‹¤ë©´ ì§€ì  ê°ì‚¬ í•˜ê² ìŠµë‹ˆë‹¤ğŸ«¡

> **ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ í…ŒìŠ¤íŠ¸ í•˜ë©´ì„œ ì•½ê°„ì˜ ê³¼ê¸ˆì´ ë°œìƒí•  ê²ƒ ì…ë‹ˆë‹¤ã… ã…  ê³¼ê¸ˆì„ ì›ì¹˜ ì•Šìœ¼ì‹œë©´ ë”°ë¼í•˜ì‹œë©´ ì•ˆë©ë‹ˆë‹¤!ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥**

# ì „ì²´ ë°°í¬ ê³¼ì • ê°œìš”

1ï¸âƒ£ EC2 ì¸ìŠ¤í„´ìŠ¤ ì„¤ì • (ì„œë²„ ì¤€ë¹„)
2ï¸âƒ£ ë„ë©”ì¸ & Nginx ì„¤ì • (HTTPS & ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ)
3ï¸âƒ£ Dockerfile ì‘ì„± & GitHub Actions ì„¤ì • (CI/CD ìë™í™”)
4ï¸âƒ£ GitHub Actions â†’ Docker Hub â†’ EC2 ìë™ ë°°í¬
5ï¸âƒ£ ì‹¤ì œ ë„ë©”ì¸ ì—°ê²° ë° ìµœì¢… í™•ì¸

## 1. EC2 ì¸ìŠ¤í„´ìŠ¤ ì„¤ì • (ì„œë²„ ì¤€ë¹„)

> AWS EC2: AWSì—ì„œ ì œê³µ í•˜ëŠ” ê°€ìƒ ì„œë²„ -> ì‰½ê²Œ ë§í•´ ì»´í“¨í„° í•œëŒ€ë¥¼ AWSì—ì„œ ë¹Œë ¤ ì¤€ë‹¤ê³  ìƒê°

ê¸°ì¡´ì˜ ë¦¬ì•¡íŠ¸ ì•±ì€ S3 ê°™ì€ ì •ì  í˜¸ìŠ¤íŒ…ë§Œìœ¼ë¡œë„ ì¶©ë¶„íˆ ë°°í¬ê°€ ê°€ëŠ¥í•˜ë‹¤ê³  í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ Next.js ê°™ì€ ê²½ìš°ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ SSRì´ê¸°ë„ í•˜ê³  Dockerë¥¼ ì‚¬ìš©í•  ê²ƒì´ê¸°ì— ê°€ìƒ ì„œë²„ê°€ í•„ìˆ˜ì ìœ¼ë¡œ í•„ìš”í•©ë‹ˆë‹¤.

### 1-1. EC2 ì¸ìŠ¤í„´ìŠ¤ ìƒì„±

AWS ì½˜ì†”ì— ì ‘ì†í•´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤.

- ì¸ìŠ¤í„´ìŠ¤ ì‹œì‘ ë²„íŠ¼ í´ë¦­
  ![](https://velog.velcdn.com/images/boyfromthewell/post/fc90efd0-bd05-4b20-88e7-1df027695066/image.png)

ìš´ì˜ì²´ì œ-> Ubuntu ì„ íƒ
ì¸ìŠ¤í„´ìŠ¤ ìœ í˜•-> í”„ë¦¬í‹°ì–´ ì„ íƒ (t2.micro)

- í‚¤ í˜ì–´ ìƒì„±
  ![](https://velog.velcdn.com/images/boyfromthewell/post/b6fb641f-3d74-4d57-a4c3-f45344d797d7/image.png)
  ì—¬ê¸°ì„œ ìƒì„±í•œ í‚¤ í˜ì–´ pem íŒŒì¼ì´ ìë™ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œ ë˜ëŠ”ë° ê¼­ ì•ˆì „í•œ íŒŒì¼ì— ìƒì–´ë²„ë¦¬ì§€ ì•Šë„ë¡ ì €ì¥í•©ë‹ˆë‹¤.

### 1.2. SSHë¡œ EC2 ì ‘ì† (ê³¼ê¸ˆ ì£¼ì˜)

ì´ì œ AWSê°€ ë¹Œë ¤ì¤€ ì»´í“¨í„°ì— SSHë¥¼ í†µí•´ ì ‘ì†ì´ ì˜ë˜ëŠ”ì§€ ì‹œë„í•´ë³´ê² ìŠµë‹ˆë‹¤.

ê¸°ë³¸ì ìœ¼ë¡œ AWSê°€ í• ë‹¹í•´ì¤€ í¼ë¸”ë¦­ IP ì£¼ì†Œê°€ ìˆì§€ë§Œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¤‘ì§€í•˜ê³  ìƒˆë¡œ ì‹œì‘í•˜ë©´ ë‹¤ë¥¸ IP ì£¼ì†Œê°€ í• ë‹¹ ëœë‹¤ê³  í•©ë‹ˆë‹¤.

ê·¸ëŒ€ë¡œ ì§„í–‰í•œë‹¤ë©´ ì¸ìŠ¤í„´ìŠ¤ê°€ ì¤‘ì§€ë ë•Œë§ˆë‹¤ ì„¤ì •ì„ ë‹¤ ë°”ê¿”ì¤˜ì•¼í•˜ê¸°ì—, ì‹¤ì œ ë°°í¬ í™˜ê²½ì´ë¼ê³  ìƒê°í•˜ê³  ë¨¼ì € íƒ„ë ¥ì  IPë¥¼ í• ë‹¹ ë°›ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. **(ê³¼ê¸ˆ ì£¼ì˜)**

> **ì£¼ì˜: ğŸ”¥ğŸ”¥íƒ„ë ¥ì  IPë¥¼ í• ë‹¹ ë°›ê²Œë˜ë©´ ì‹œê°„ë‹¹ ê³¼ê¸ˆì´ ë°œìƒí•˜ë‹ˆ í…ŒìŠ¤íŠ¸í•˜ê³  ê¼­ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¤‘ì§€í•˜ì…”ì•¼ í•©ë‹ˆë‹¤!!ğŸ”¥ğŸ”¥**

![](https://velog.velcdn.com/images/boyfromthewell/post/395af9c9-07c7-40fb-9511-329803835290/image.png)

ì¢Œì¸¡ ë©”ë‰´ íƒ„ë ¥ì  IP -> ì„¤ì • ê·¸ëŒ€ë¡œ ìƒì„± (ì§€ì—­ì€ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•œ ì§€ì—­ê³¼ ë§ì¶°ì£¼ì…”ì•¼ í•©ë‹ˆë‹¤)
![](https://velog.velcdn.com/images/boyfromthewell/post/6ee12b42-2a4c-4387-9209-b76f716a205f/image.png)

ìƒì„±í•˜ê²Œ ë˜ë©´ IP ì£¼ì†Œê°€ í• ë‹¹ë˜ì—ˆë‹¤ëŠ” ì´ˆë¡ìƒ‰ ì°½ì´ ëœ¨ëŠ”ë° íƒ„ë ¥ì  IP ì£¼ì†Œ ì—°ê²° ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤.
![](https://velog.velcdn.com/images/boyfromthewell/post/a16b8c57-5ed9-4b3b-aefa-d94e8fd79510/image.png)

ë°©ê¸ˆ ìƒì„±í•œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì„ íƒí•´ì£¼ê³ , í”„ë¼ì´ë¹— IP ì£¼ì†ŒëŠ” ìë™ìœ¼ë¡œ ê·¸ ì¸ìŠ¤í„´ìŠ¤ì˜ ì£¼ì†Œê°€ ëœ°í…ë° ê·¸ ì£¼ì†Œë¥¼ ì„ íƒí•´ ì¤ë‹ˆë‹¤.

ì´ì œ ì§„ì§œ í„°ë¯¸ë„ ì°½ì—ì„œ ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ì† í•´ë³´ê² ìŠµë‹ˆë‹¤
í‚¤ í˜ì–´ê°€ ì €ì¥ ëœ ìœ„ì¹˜ì—ì„œ í„°ë¯¸ë„ ì—´ê¸° -> `ssh -i "í‚¤ í˜ì–´ íŒŒì¼" ubuntu@ë°©ê¸ˆ í• ë‹¹ ë°›ì€ íƒ„ë ¥ì  IP ì£¼ì†Œ`

ì ‘ì†ì— ì„±ê³µí–ˆë‹¤ë©´ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•´ì¤ë‹ˆë‹¤.

```
// íŒ¨í‚¤ì§€ ëª©ë¡ ì—…ë°ì´íŠ¸ & ì—…ê·¸ë ˆì´ë“œ
sudo apt update && sudo apt upgrade -y

// Docker ì„¤ì¹˜
sudo apt install docker.io -y

// Dockerë¥¼ ë¶€íŒ… ì‹œ ìë™ ì‹¤í–‰ë˜ë„ë¡ ì„¤ì •
sudo systemctl enable docker

// Docker ì„œë¹„ìŠ¤ ì‹œì‘
sudo systemctl start docker
```

ì™„ë£Œ í›„ ë„ì»¤ ë²„ì „ í™•ì¸ ëª…ë ¹ì–´ë¥¼ í†µí•´ ì˜ ì„¤ì¹˜ë¬ë‚˜ í™•ì¸í•´ë´¤ìŠµë‹ˆë‹¤ -> `docker --version`

`Docker version 26.1.3, build 26.1.3-..` ê°™ì´ ë‚˜ì˜¤ë©´ ì„±ê³µì…ë‹ˆë‹¤!

## 2. ë„ë©”ì¸ & Nginx ì„¤ì • (HTTPS & ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ)

### 2.1 ë„ë©”ì¸ êµ¬ë§¤ ë° IP ì—°ê²°

ë„ë©”ì¸ì„ êµ¬ë§¤í•œ ë’¤ ì¸ìŠ¤í„´ìŠ¤ IPë¥¼ AWS Route 53ì„ í†µí•´ ì—°ê²°í•´ì£¼ëŠ” ì‘ì—…ì´ í•„ìš”í•©ë‹ˆë‹¤.

ë„ë©”ì¸ êµ¬ë§¤ëŠ” ê°€ë¹„ì•„ì—ì„œ ì‹¤ìŠµì„ ìœ„í•´ ë‹¨ëˆ ë§Œì›ì— êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤!

êµ¬ë§¤í•œ ë„ë©”ì¸ ì—°ê²°ì€ í•´ë‹¹ ê¸€ì— ë§¤ìš° ì„¤ëª…ì´ ì˜ë˜ìˆì–´ ì—¬ê¸°ì„œ ë³´ê³  ë”°ë¼ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.

[Route 53 ë„ë©”ì¸ ì—°ê²°](https://velog.io/@xka926/Route-53-%EB%8F%84%EB%A9%94%EC%9D%B8-%EC%97%B0%EA%B2%B0)

### 2.2 Nginx ì„¤ì¹˜ ë° https ì„¤ì •

ë‹¤ì‹œ SSHë¡œ ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ì†í•œë’¤ í•´ë‹¹ ëª…ë ¹ì–´ë¥¼ ì…ë ¥ í•´ì¤ë‹ˆë‹¤.

```
// nginx ì„¤ì¹˜
sudo apt install nginx -y
sudo systemctl start nginx
sudo systemctl enable nginx
```

ì•ì„  ë‹¨ê³„ê¹Œì§€ ì§„í–‰ì´ ì˜ ë˜ì—ˆë‹¤ë©´ ë¸Œë¼ìš°ì €ì—ì„œ `http://EC2 ì¸ìŠ¤í„´ìŠ¤ IP` ì ‘ì† ì‹œ Nginx Welcome Page ê°™ì€ ê¸°ë³¸ í˜ì´ì§€ê°€ ëœ¨ë©´ ì„±ê³µì…ë‹ˆë‹¤!!

âœ…ë‹¤ìŒìœ¼ë¡œëŠ” https ì‚¬ìš©ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ê¸° ìœ„í•´ Let's Encryptë¼ëŠ” ÃŸì¸ì¦ì„œë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤. (ë¬´ë£Œ)

```
sudo apt install certbot python3-certbot-nginx -y
```

- certbot: Let's Encrypt ì¸ì¦ì„œë¥¼ ë°œê¸‰í•˜ê³  ê´€ë¦¬í•˜ëŠ” íˆ´
- python3-certbot-nginx: Certbotì´ Nginx ì„¤ì •ê³¼ ì—°ë™ë˜ë„ë¡ ë„ì™€ì¤Œ

```
sudo certbot --nginx -d example.com -d www.example.com
```

êµ¬ë§¤í•œ ë„ë©”ì¸ì„ example.com ëŒ€ì‹  ì…ë ¥í•´ì¤ë‹ˆë‹¤.

## 3. Dockerfile & GitHub Actions ì„¤ì • (CI/CD ìë™í™”)

### 3.1 Dockerfile ì‘ì„±

ìš°ì„  ë„ì»¤ ì´ë¯¸ì§€ ë¹Œë“œ, ì»¨í…Œì´ë„ˆ ìƒì„±ì„ ìœ„í•´ ì›í•˜ëŠ” í”„ë¡œì íŠ¸ì˜ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì— Dockerfileì„ ì‘ì„±í•´ì¤ë‹ˆë‹¤.

âœ…ë„ì»¤ í—ˆë¸Œë¥¼ ì´ìš©í• ê²ƒì´ê¸° ë•Œë¬¸ì— ë„ì»¤ í—ˆë¸Œ ê³„ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.
https://hub.docker.com

> âœ… ë„ì»¤ ì´ë¯¸ì§€? í”„ë¡œê·¸ë¨ ì‹¤í–‰ì— í•„ìš”í•œ ëª¨ë“ ê±¸ í¬í•¨í•œ íŒ¨í‚¤ì§€ (ì½”ë“œ, ë¼ì´ë¸ŒëŸ¬ë¦¬, í™˜ê²½ ì„¤ì • ë“±ì„ ë‹´ê³  ìˆìŒ)

> âœ… ë„ì»¤ ì»¨í…Œì´ë„ˆ? ê·¸ ì´ë¯¸ì§€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ì´ë¯¸ì§€ë¥¼ ì‹¤í–‰í•œ í”„ë¡œê·¸ë¨

```dockerfile
# ë¹Œë“œ ë‹¨ê³„
FROM node:lts AS builder

WORKDIR /app

COPY package*.json ./
RUN npm install --legacy-peer-deps

COPY . .
RUN npm run build

# ì‹¤í–‰ ë‹¨ê³„
FROM node:18-alpine

WORKDIR /app

COPY --from=builder /app/package*.json ./
COPY --from=builder /app/.next ./.next
COPY --from=builder /app/public ./public
COPY --from=builder /app/node_modules ./node_modules

EXPOSE 3000
CMD ["npm", "run", "start"]
```

ê¸°ì¡´ì˜ ë¦¬ì•¡íŠ¸ í”„ë¡œì íŠ¸(vite, cra..)ë¥¼ ë„ì»¤ë¼ì´ì§• í•  ë•ŒëŠ” í”„ë¡œì íŠ¸ê°€ ì •ì ì¸ íŒŒì¼ì„ ìƒì„±í•˜ê¸° ë•Œë¬¸ì— nginxë¡œ ì„œë¹™í–ˆë‹¤ë©´ Next.jsëŠ” ê¸°ë³¸ì ìœ¼ë¡œ SSRì„ ì œê³µí•˜ê¸° ë•Œë¬¸ì— Node.js ëŸ°íƒ€ì„ í™˜ê²½ì´ í•„ìš”í•˜ë‹¤ëŠ” íŠ¹ì§•ì´ ìˆëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤.

```
node_modules
.next
.git
.gitignore
Dockerfile
```

.dockerignore íŒŒì¼ë„ ì‘ì„±í•´ ì£¼ì—ˆìŠµë‹ˆë‹¤.

### 3.2 GitHub Actions ì„¤ì •

GitHub Actionsë¥¼ ì´ìš©í•´ ì½”ë“œê°€ main ë¸Œëœì¹˜ì— í‘¸ì‹œë  ë•Œ ìë™ìœ¼ë¡œ EC2 ì„œë²„ì— ë°°í¬í•˜ëŠ” ê³¼ì •ì…ë‹ˆë‹¤.

ìš°ì„  í”„ë¡œì íŠ¸ ë£¨íŠ¸ ê²½ë¡œì— ë‹¤ìŒê³¼ ê°™ì€ íŒŒì¼ì„ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.
`.github/workflows/deploy.yml` (íŒŒì¼ ì´ë¦„ì€ ììœ )

```yml
name: deploy myapp

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: ì½”ë“œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v3

      - name: Docker ì´ë¯¸ì§€ ë¹Œë“œ, í‘¸ì‹œ
        run: |
          echo "${{ secrets.DOCKER_PASSWORD }}" | docker login -u "${{ secrets.DOCKER_USERNAME }}" --password-stdin
          docker build -t ${{ secrets.DOCKER_USERNAME }}/myapp:latest .
          docker push ${{ secrets.DOCKER_USERNAME }}/myapp:latest

      - name: EC2ì— SSH ì ‘ì† í›„ ë°°í¬
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.EC2_HOST }}
          username: ubuntu
          key: ${{ secrets.EC2_SSH_KEY }}
          script: |
            sudo docker pull ${{ secrets.DOCKER_USERNAME }}/myapp:latest
            sudo docker stop myapp || true
            sudo docker rm myapp || true
            sudo docker run -d -p 3000:3000 --name myapp ${{ secrets.DOCKER_USERNAME }}/myapp:latest
```

#### workflow ê³¼ì •

```yml
name: deploy myapp
```

GitHub Actionsì—ì„œ ì‹¤í–‰ë  ì›Œí¬í”Œë¡œìš°ì˜ ì´ë¦„

```yml
on:
  push:
    branches:
      - main
```

main ë¸Œëœì¹˜ì— ì½”ë“œê°€ í‘¸ì‹œë  ë•Œ ì‹¤í–‰

```yml
jobs:
  deploy:
    runs-on: ubuntu-latest
```

ë°°í¬ ì‘ì—…ì„ ì‹¤í–‰í•  í™˜ê²½ì„ ubuntu-latestë¡œ ì§€ì • (GitHub ì œê³µ ê°€ìƒ ë¨¸ì‹ ì—ì„œ ì‹¤í–‰)

**1. ì½”ë“œ ì²´í¬ì•„ì›ƒ**

```yml
- name: ì½”ë“œ ì²´í¬ì•„ì›ƒ
  uses: actions/checkout@v3
```

í˜„ì¬ ì €ì¥ì†Œì˜ ì½”ë“œë¥¼ ê°€ì ¸ì˜´ (GitHub Actions ë‚´ì—ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•´)

**2. Docker ì´ë¯¸ì§€ ë¹Œë“œ ë° ë„ì»¤ í—ˆë¸Œì— í‘¸ì‹œ**

```yml
- name: Docker ì´ë¯¸ì§€ ë¹Œë“œ, í‘¸ì‹œ
  run: |
    echo "${{ secrets.DOCKER_PASSWORD }}" | docker login -u "${{ secrets.DOCKER_USERNAME }}" --password-stdin
    docker build -t ${{ secrets.DOCKER_USERNAME }}/myapp:latest .
    docker push ${{ secrets.DOCKER_USERNAME }}/myapp:latest
```

Docker Hub ë¡œê·¸ì¸

- secrets.DOCKER_USERNAME â†’ GitHub Secretsì— ì €ì¥ëœ Docker Hub ì•„ì´ë””
- secrets.DOCKER_PASSWORD â†’ Docker Hub ë¹„ë°€ë²ˆí˜¸
- Docker ì´ë¯¸ì§€ ë¹Œë“œ & Docker hubì— push

**âœ… ì—¬ê¸°ì„œ Github Secretsë¥¼ ì„¤ì •í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤!**
`GitHub â†’ Repository â†’ Settings â†’ Secrets and Variables -> Actions`

![](https://velog.velcdn.com/images/boyfromthewell/post/fb28262c-61f2-4aea-9be2-77157dbc534d/image.png)

`DOCKER_USERNAME` = Docker Hub ê³„ì • ì•„ì´ë””
`DOCKER_PASSWORD` = Docker Hub ë¹„ë°€ë²ˆí˜¸
`EC2_HOST` = EC2 ì¸ìŠ¤í„´ìŠ¤ì—ì„œ í• ë‹¹ ë°›ì•˜ë˜ íƒ„ë ¥ì  IP
`EC2_SSH_KEY` = í‚¤ í˜ì–´ íŒŒì¼ì´ ì €ì¥ ëœ ìœ„ì¹˜ -> `cat 'ì¸ìŠ¤í„´ìŠ¤ ìƒì„±ì‹œ ë°œê¸‰ ë°›ì€ í‚¤ í˜ì–´ íŒŒì¼'` ì‹¤í–‰ í›„ ë³µì‚¬

> **ğŸ”¥ğŸ”¥ì—¬ê¸°ì„œ í‚¤í˜ì–´ íŒŒì¼ì„ ë³µì‚¬í• ë•Œ ì£¼ì˜ í•  ì ì´ ìˆìŠµë‹ˆë‹¤ğŸ”¥ğŸ”¥**

```
-----BEGIN OPENSSH PRIVATE KEY-----
ìŒ¸ë¼ìŒ¸ë¼...fdfdfdfd
-----END OPENSSH PRIVATE KEY-----
```

êµ¬ë¶„ì„  ì•ˆì˜ ë‚´ìš©ë§Œ ë³µì‚¬í•˜ëŠ”ê²ƒì´ ì•„ë‹Œ `-----BEGIN OPENSSH PRIVATE KEY-----` ë¶€í„° `-----END OPENSSH PRIVATE KEY-----` ì´ë¶€ë¶„ê¹Œì§€ ì „ë¶€ ë³µì‚¬í•´ì•¼ í•©ë‹ˆë‹¤!!

**3. EC2 ì„œë²„ì— SSH ì ‘ì† í›„ ë°°í¬**

```yml
- name: EC2ì— SSH ì ‘ì† í›„ ë°°í¬
  uses: appleboy/ssh-action@master
  with:
    host: ${{ secrets.EC2_HOST }}
    username: ubuntu
    key: ${{ secrets.EC2_SSH_KEY }}
    script: |
      sudo docker pull ${{ secrets.DOCKER_USERNAME }}/myapp:latest
      sudo docker stop myapp || true
      sudo docker rm myapp || true
      sudo docker run -d -p 3000:3000 --name myapp ${{ secrets.DOCKER_USERNAME }}/myapp:latest
```

EC2 ì„œë²„ì— SSH ì ‘ì†í•œë’¤ ë‹¤ìŒê³¼ ê°™ì€ ê³¼ì •ì„ ê±°ì¹©ë‹ˆë‹¤.

**âœ… EC2ì—ì„œ Docker ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ê³¼ì •**

- ìµœì‹  Docker ì´ë¯¸ì§€ë¥¼ ë„ì»¤ í—ˆë¸Œì—ì„œ pull
- ê¸°ì¡´ ì»¨í…Œì´ë„ˆ myappì´ ì‹¤í–‰ ì¤‘ì´ë¼ë©´ stop
- ê¸°ì¡´ ì»¨í…Œì´ë„ˆë¥¼ rm (ì‚­ì œ)
- ìƒˆë¡œìš´ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰ (3000ë²ˆ í¬íŠ¸ì—ì„œ ì‹¤í–‰)

> âœ… ì‘ì„±í•œ yml íŒŒì¼ì—ì„œ `uses`ë¼ëŠ” ëª…ë ¹ì–´ê°€ ìì£¼ ë³´ì´ëŠ”ë° ë‹¤ë¥¸ ì‚¬ëŒì´ ë§Œë“  ì•¡ì…˜(Action) ë˜ëŠ” GitHub ì œê³µ ê¸°ë³¸ ì•¡ì…˜ì„ ì‚¬ìš©í•  ë•Œ ì“°ì´ëŠ” í‚¤ì›Œë“œë¼ê³  í•©ë‹ˆë‹¤ -> **ì´ë¯¸ ë§Œë“¤ì–´ì§„ ì•¡ì…˜ì„ ë¶ˆëŸ¬ì™€ì„œ ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ì—­í• !**

## 4. Nginxë¥¼ ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ(reverse proxy) ì„¤ì •

ì´ì œ ê±°ì˜ë‹¤ ì™”ìŠµë‹ˆë‹¤!!
ë§ˆì§€ë§‰ìœ¼ë¡œ nginxë¥¼ ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œë¡œ ì‚¬ìš©í•˜ì—¬ Next.js (í¬íŠ¸ 3000ë²ˆ) ì„œë²„ë¡œ ìš”ì²­ì„ ì „ë‹¬í•˜ëŠ” ê³¼ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.

### 4.1 Nginx ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ì„¤ì •

ë‹¤ì‹œ ì»¤ë§¨ë“œ ì°½ì—ì„œ sshì— ì ‘ì†í•´ í•´ë‹¹ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í–ˆìŠµë‹ˆë‹¤.

`sudo nano /etc/nginx/sites-available/default`

âœ… Nginxì˜ ê¸°ë³¸ ì„¤ì • íŒŒì¼(default)ì„ nano ì—ë””í„°ë¡œ ìˆ˜ì •í•˜ëŠ” ëª…ë ¹ì–´ ì…ë‹ˆë‹¤.

```
server {
    listen 80;
    listen [::]:80;
    server_name mywebsite.com www.mywebsite.com;
    return 301 https://mywebsite.com$request_uri; # HTTP â†’ HTTPS ë¦¬ë””ë ‰ì…˜
}

server {
    listen 443 ssl;
    listen [::]:443 ssl;
    server_name mywebsite.com www.mywebsite.com;

    ssl_certificate /etc/letsencrypt/live/mywebsite.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/mywebsite.com/privkey.pem;
    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

https ì„¤ì •ì‹œ Certbotì´ ìë™ìœ¼ë¡œ ì‹¬ì–´ì¤€ ì„¤ì •ë„ ìˆì—ˆìŠµë‹ˆë‹¤.
ì£¼ì„ë„ ë§ê³  ì§€ì €ë¶„í•´ ìë™ìœ¼ë¡œ ì‹¬ì–´ì¤€ ì„¤ì •ì„ ì¼ë¶€ë§Œ ë‚¨ê¸°ê³  ë‹¤ì‹œ ì‘ì„± í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.

#### ì²«ë²ˆì§¸ server ë¸”ë¡ (80ë²ˆ í¬íŠ¸ -http ì²˜ë¦¬)

```
server {
    listen 80;
    listen [::]:80;
    server_name mywebsite.com www.mywebsite.com;
    return 301 https://mywebsite.com$request_uri; # HTTP â†’ HTTPS ë¦¬ë””ë ‰ì…˜
}
```

http ìš”ì²­ìœ¼ë¡œ ì ‘ì†í•˜ê²Œ ë˜ë©´ httpsë¡œ ìë™ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜ ì‹œì¼œì£¼ëŠ” ì—­í• ì…ë‹ˆë‹¤

#### ë‘ë²ˆì§¸ server ë¸”ë¡ (443ë²ˆ í¬íŠ¸ - https ìš”ì²­ ì²˜ë¦¬)

```
server {
    listen 443 ssl;
    listen [::]:443 ssl;
    server_name mywebsite.com www.mywebsite.com;

    ssl_certificate /etc/letsencrypt/live/mywebsite.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/mywebsite.com/privkey.pem;
    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

    location / {
        proxy_pass http://localhost:3000; # Next.js ì„œë²„ë¡œ í”„ë¡ì‹œ
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

https í¬íŠ¸ì—ì„œ ìš”ì²­ì„ ë°›ê²Œ ë˜ë©´ ì‘ë™í•˜ëŠ” ë¶€ë¶„ì…ë‹ˆë‹¤.

Let's Encrypt SSL ì¸ì¦ì„œ ì ìš© ëœ ë¶€ë¶„ì€ ë‚¨ê²¨ë†“ì•˜ìŠµë‹ˆë‹¤.

```
location / {
    proxy_pass http://localhost:3000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}
```

ì´ ë¶€ë¶„ì€ ì‚¬ìš©ìê°€ ì§€ì •í•œ ë„ë©”ì¸ìœ¼ë¡œ ì ‘ì†í•˜ë©´ nginxê°€ ìš”ì²­ì„ Next.js ì„œë²„ë¡œ ì „ë‹¬í•´ì£¼ëŠ” ë¶€ë¶„ì…ë‹ˆë‹¤.

âœ… í˜„ì¬ AWS EC2ì˜ ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ì‹¤í–‰ë˜ê³  ìˆëŠ” ë„ì»¤ ì»¨í…Œì´ë„ˆê°€ 3000ë²ˆ í¬íŠ¸ì—ì„œ Next.js ì„œë²„ë¥¼ ì‹¤í–‰ ì¤‘
âœ… ì‚¬ìš©ìê°€ ì§€ì •í•œ URLë¡œ ìš”ì²­í•˜ë©´ nginxê°€ í•´ë‹¹ ìš”ì²­ì„ ì»¨í…Œì´ë„ˆë¡œ í”„ë¡ì‹œí•˜ì—¬ ì ‘ì†í•  ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.

> ì¦‰ nginxê°€ EC2ì˜ "localhost:3000"ì„ ë°”ë¼ë³´ê³  ì»¨í…Œì´ë„ˆë¡œ ì—°ê²°í•´ ì£¼ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤

## 5. ìµœì¢… í™•ì¸

```tsx
// @/app/page.tsx
export default function Home() {
  return (
    <div>
      <h1>ì•ˆë…•í•˜ì„¸ìš” next.js ì•±ì…ë‹ˆë‹¤.</h1>
    </div>
  );
}
```

CNAë¡œ ì„¸íŒ…í•œ ì‘ì—… ë‚´ìš©ì„ ë©”ì¸ ë¦¬í¬ì§€í† ë¦¬ì— pushí•©ë‹ˆë‹¤.

âœ…ë¦¬í¬ì§€í† ë¦¬ì˜ Actions íƒ­ì— ë“¤ì–´ê°€ë©´ Github Actionsê°€ ìˆ˜í–‰ì¤‘ì¸ ë¡œê·¸ë¥¼ ë³¼ìˆ˜ ìˆìŠµë‹ˆë‹¤.
![](https://velog.velcdn.com/images/boyfromthewell/post/4783b460-0578-4def-97c4-66950adf9eb2/image.png)

ì˜¤ë¥˜ ì—†ì´ ì •ìƒì ìœ¼ë¡œ ëª¨ë“  actionë“¤ì´ ìˆ˜í–‰ë˜ì—ˆë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì€ í™”ë©´ì´ ë‚˜ì˜µë‹ˆë‹¤ ì„±ê³µ!

![](https://velog.velcdn.com/images/boyfromthewell/post/cd4358a8-63b2-4557-a1bd-1bc5fa4f702c/image.png)

ì„¤ì •í•œ ë„ë©”ì¸ìœ¼ë¡œ ì ‘ì†í•˜ê²Œ ë˜ë©´ ëª¨ë“  ê³¼ì •ì´ ìë™ìœ¼ë¡œ ì²˜ë¦¬ë˜ì–´ ë°°í¬í•œ Next.js ì•±ì´ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ëœ ëª¨ìŠµì…ë‹ˆë‹¤! êµ³ğŸ˜
![](https://velog.velcdn.com/images/boyfromthewell/post/41b024e1-2b12-4bbf-96c3-5ff573186350/image.png)

ì¶”ê°€ì ì¸ í˜ì´ì§€ë¥¼ ë§Œë“¤ì–´ ë‹¤ë¥¸ ì‘ì—…ì„ ì§„í–‰í•´ë³´ì•˜ìŠµë‹ˆë‹¤.
âœ…ì™¸ë¶€ API í˜¸ì¶œí•˜ê³  ë°ì´í„°ë¥¼ ë°›ì•„ ì˜¤ëŠ” í˜ì´ì§€ë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.

```tsx
// @app/todo/page.tsx
export default async function Page() {
  const res = await fetch("https://jsonplaceholder.typicode.com/todos");
  const todo = (await res.json()) as {
    userId: number;
    id: number;
    title: string;
    completed: boolean;
  }[];

  return (
    <h1>
      {todo.map(({ userId, id, title, completed }) => (
        <div key={id}>
          <h2>{userId}</h2>
          <h3>{title}</h3>
          <div>{completed ? "í–ˆìŒ" : "ì•ˆí—€ìŒ"}</div>
        </div>
      ))}
    </h1>
  );
}
```

ì‘ì—… í•œë’¤ ë©”ì¸ì— pushí•˜ê²Œ ë˜ë©´ ë‹¤ì‹œ Github Actionsê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.

ëª¨ë“  ì‘ì—…ì´ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰ë¬ê³  todo í˜ì´ì§€ì— ì ‘ì†í•´ë´¤ìŠµë‹ˆë‹¤.

![](https://velog.velcdn.com/images/boyfromthewell/post/a736b873-76fd-4c0d-8968-d676e0301dee/image.png)
ë³€ë™ì‚¬í•­ì´ ì ìš©ë˜ì—ˆê³  ë°°í¬ê°€ ì˜ë˜ì—ˆìŠµë‹ˆë‹¤. ê°œê¿€~ğŸ˜

> **ë§Œì•½ì— ì´ ê¸€ì„ ë³´ê³  ë”°ë¼í•˜ì‹  ë¶„ì´ ìˆë‹¤ë©´ ê¼­ ì¸ìŠ¤í„´ìŠ¤ ì¢…ë£Œí•´ì£¼ì„¸ìš”!!! ì•ˆê·¸ëŸ¬ë©´ ê³¼ê¸ˆ ê³„ì† ë©ë‹ˆë‹¤ã… ã… **

> _ëŠë‚€ì : Github Actionsë¥¼ ë‹¤ë¤„ë³´ëŠ”ê²Œ ì£¼ëœ ë‚´ìš©ì´ ë ê²ƒ ê°™ì•˜ì§€ë§Œ ì„¸íŒ…í•˜ëŠ” ë¶€ë¶„ì´ ëŒ€ë¶€ë¶„ì´ë¼ ë§ì€ ì‚½ì§ˆì´ ìˆì—ˆìŠµë‹ˆë‹¤. ì €ëŠ” ê¸°ì¡´ì— ë„ì»¤ ì´ë¯¸ì§€ ë¹Œë“œ, ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì •ë„ë§Œ ë‹¤ë£°ì¤„ ì•„ëŠ” ìˆ˜ì¤€ì´ì—ˆëŠ”ë° ì´ëŸ° ê³¼ì •ì„ ì§ì ‘ í•´ë³´ë©´ì„œ ë°°í¬ì™€ ì¸í”„ë¼ ìš´ì˜ì— ëŒ€í•œ ì‹¤ë¬´ì ì¸ ê°ê°ì„ ìµí ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤!!
> _
